{"version":3,"file":"pending.min.js","sources":["../src/pending.js"],"sourcesContent":["import ModalFactory from 'core/modal_factory';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport { renderPost } from './utils/renderPost';\n\n/**\n * Inicializa los listeners para mostrar detalles de respuestas AI.\n */\nexport const init = () => {\n    // Botón de ver detalles\n    document.querySelectorAll('.view-details').forEach(btn => {\n        btn.addEventListener('click', e => {\n            const token = e.currentTarget.dataset.token;\n\n            Ajax.call([{\n                methodname: 'local_forum_ai_get_details',\n                args: { token: token },\n            }])[0].done(data => {\n                ModalFactory.create({\n                    type: ModalFactory.types.DEFAULT,\n                    title: 'Detalles del debate',\n                    body: renderDiscussion(data, true),\n                    large: true,\n                }).done(modal => {\n                    modal.show();\n\n                    // Inicializar handlers\n                    initAiEditHandlers(modal.getRoot(), data.token);\n                });\n            }).fail(Notification.exception);\n        });\n    });\n\n    // Botones de aprobar/rechazar desde la tabla\n    document.querySelectorAll('.action-btn').forEach(btn => {\n        btn.addEventListener('click', e => {\n            e.preventDefault();\n            const token = btn.dataset.token;\n            const action = btn.dataset.action;\n\n            Ajax.call([{\n                methodname: 'local_forum_ai_approve_response',\n                args: { token: token, action: action },\n            }])[0].done(() => {\n                const row = btn.closest('tr');\n                if (row) {\n                    row.remove();\n                }\n            }).fail(Notification.exception);\n        });\n    });\n};\n\n/**\n * Construye el HTML para el modal de detalles.\n *\n * @param {Object} data Datos recibidos del servicio AJAX.\n * @param {boolean} editMode Si debe iniciar directamente en modo edición.\n * @returns {string} HTML\n */\nfunction renderDiscussion(data, editMode = false) {\n    let html = `<h4>${data.course} / ${data.forum}</h4>\n                <h5>Debate: ${data.discussion}</h5>`;\n\n    if (data.posts.length === 0) {\n        html += '<p class=\"text-warning\">No se encontraron posts en este debate.</p>';\n    } else {\n        data.posts.forEach((post) => {\n            html += renderPost(post);\n        });\n    }\n\n    html += `<div class=\"alert alert-primary mt-4\">\n               <h5><i class=\"fa-solid fa-robot\"></i> Respuesta AI propuesta</h5>\n               <div id=\"airesponse-content\" data-token=\"${data.token}\">`;\n\n    if (editMode) {\n        // Mostrar directamente en modo edición\n        html += `\n            <textarea id=\"airesponse-edit\" class=\"form-control\" rows=\"5\">${data.airesponse}</textarea>\n            <div class=\"mt-2\">\n                <button class=\"btn btn-success btn-sm save-ai\" data-token=\"${data.token}\">\n                    <i class=\"fa-solid fa-floppy-disk\"></i> Guardar\n                </button>\n                <button class=\"btn btn-primary btn-sm save-approve-ai\" data-token=\"${data.token}\">\n                    <i class=\"fa-solid fa-check\"></i> Guardar y Aprobar\n                </button>\n                <button class=\"btn btn-danger btn-sm reject-ai\" data-token=\"${data.token}\">\n                    <i class=\"fa-solid fa-times\"></i> Rechazar\n                </button>\n            </div>\n        `;\n    } else {\n        // Vista normal\n        html += data.airesponse;\n    }\n\n    html += `</div></div>`;\n    return html;\n}\n\n/**\n * Inicializa los handlers para editar/guardar dentro de un modal específico.\n *\n * @param {object} root El contenedor raíz del modal.\n * @param {string} token Token único de aprobación asociado.\n */\nfunction initAiEditHandlers(root, token) {\n    // Guardar cambios\n    root.on('click', '.save-ai', e => {\n        e.preventDefault();\n        const newMessage = root.find('#airesponse-edit').val();\n\n        Ajax.call([{\n            methodname: 'local_forum_ai_update_response',\n            args: { token: token, message: newMessage },\n        }])[0].done(response => {\n            root.find('#airesponse-content').html(response.message);\n            location.reload();\n        }).fail(Notification.exception);\n    });\n\n    // Guardar y aprobar\n    root.on('click', '.save-approve-ai', e => {\n        e.preventDefault();\n        const newMessage = root.find('#airesponse-edit').val();\n\n        Ajax.call([{\n            methodname: 'local_forum_ai_update_response',\n            args: { token: token, message: newMessage },\n        }])[0].done(() => {\n            Ajax.call([{\n                methodname: 'local_forum_ai_approve_response',\n                args: { token: token, action: 'approve' },\n            }])[0].done(() => {\n                location.reload();\n            }).fail(Notification.exception);\n        }).fail(Notification.exception);\n    });\n\n    // Rechazar\n    root.on('click', '.reject-ai', e => {\n        e.preventDefault();\n\n        Ajax.call([{\n            methodname: 'local_forum_ai_approve_response',\n            args: { token: token, action: 'reject' },\n        }])[0].done(() => {\n            location.reload();\n        }).fail(Notification.exception);\n    });\n}\n"],"names":["renderDiscussion","data","editMode","html","course","forum","discussion","posts","length","forEach","post","token","airesponse","document","querySelectorAll","btn","addEventListener","e","currentTarget","dataset","call","methodname","args","done","create","type","ModalFactory","types","DEFAULT","title","body","large","modal","show","root","on","preventDefault","newMessage","find","val","message","response","location","reload","fail","Notification","exception","action","initAiEditHandlers","getRoot","row","closest","remove"],"mappings":"+eA4DSA,iBAAiBC,UAAMC,iEACxBC,mBAAcF,KAAKG,qBAAYH,KAAKI,oDACdJ,KAAKK,2BAEL,IAAtBL,KAAKM,MAAMC,OACXL,MAAQ,sEAERF,KAAKM,MAAME,SAASC,OAChBP,OAAQ,0BAAWO,SAI3BP,kMAEsDF,KAAKU,YAIvDR,MAFAD,8FAGmED,KAAKW,8IAEHX,KAAKU,wMAGGV,KAAKU,qMAGZV,KAAKU,qIAOnEV,KAAKW,WAGjBT,qBACOA,mBA1FS,KAEhBU,SAASC,iBAAiB,iBAAiBL,SAAQM,MAC/CA,IAAIC,iBAAiB,SAASC,UACpBN,MAAQM,EAAEC,cAAcC,QAAQR,oBAEjCS,KAAK,CAAC,CACPC,WAAY,6BACZC,KAAM,CAAEX,MAAOA,UACf,GAAGY,MAAKtB,8BACKuB,OAAO,CAChBC,KAAMC,uBAAaC,MAAMC,QACzBC,MAAO,sBACPC,KAAM9B,iBAAiBC,MAAM,GAC7B8B,OAAO,IACRR,MAAKS,QACJA,MAAMC,gBAmFEC,KAAMvB,OAE9BuB,KAAKC,GAAG,QAAS,YAAYlB,IACzBA,EAAEmB,uBACIC,WAAaH,KAAKI,KAAK,oBAAoBC,oBAE5CnB,KAAK,CAAC,CACPC,WAAY,iCACZC,KAAM,CAAEX,MAAOA,MAAO6B,QAASH,eAC/B,GAAGd,MAAKkB,WACRP,KAAKI,KAAK,uBAAuBnC,KAAKsC,SAASD,SAC/CE,SAASC,YACVC,KAAKC,sBAAaC,cAIzBZ,KAAKC,GAAG,QAAS,oBAAoBlB,IACjCA,EAAEmB,uBACIC,WAAaH,KAAKI,KAAK,oBAAoBC,oBAE5CnB,KAAK,CAAC,CACPC,WAAY,iCACZC,KAAM,CAAEX,MAAOA,MAAO6B,QAASH,eAC/B,GAAGd,MAAK,mBACHH,KAAK,CAAC,CACPC,WAAY,kCACZC,KAAM,CAAEX,MAAOA,MAAOoC,OAAQ,cAC9B,GAAGxB,MAAK,KACRmB,SAASC,YACVC,KAAKC,sBAAaC,cACtBF,KAAKC,sBAAaC,cAIzBZ,KAAKC,GAAG,QAAS,cAAclB,IAC3BA,EAAEmB,+BAEGhB,KAAK,CAAC,CACPC,WAAY,kCACZC,KAAM,CAAEX,MAAOA,MAAOoC,OAAQ,aAC9B,GAAGxB,MAAK,KACRmB,SAASC,YACVC,KAAKC,sBAAaC,cA1HTE,CAAmBhB,MAAMiB,UAAWhD,KAAKU,aAE9CiC,KAAKC,sBAAaC,iBAK7BjC,SAASC,iBAAiB,eAAeL,SAAQM,MAC7CA,IAAIC,iBAAiB,SAASC,IAC1BA,EAAEmB,uBACIzB,MAAQI,IAAII,QAAQR,MACpBoC,OAAShC,IAAII,QAAQ4B,qBAEtB3B,KAAK,CAAC,CACPC,WAAY,kCACZC,KAAM,CAAEX,MAAOA,MAAOoC,OAAQA,WAC9B,GAAGxB,MAAK,WACF2B,IAAMnC,IAAIoC,QAAQ,MACpBD,KACAA,IAAIE,YAETR,KAAKC,sBAAaC"}