{"version":3,"file":"history.min.js","sources":["../src/history.js"],"sourcesContent":["import ModalFactory from 'core/modal_factory';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport { get_string as getString } from 'core/str';\nimport { renderPost } from './utils/renderPost';\n\n/**\n * Inicializa los listeners para mostrar historial de respuestas AI.\n */\nexport const init = () => {\n    document.querySelectorAll('.view-details').forEach(btn => {\n        btn.addEventListener('click', e => {\n            const token = e.currentTarget.dataset.token;\n\n            Ajax.call([{\n                methodname: 'local_forum_ai_get_details',\n                args: { token: token },\n            }])[0].done(async data => {\n                const [\n                    modalTitle,\n                    discussionLabel,\n                    noPosts,\n                    aiResponse,\n                    aiResponseApproved,\n                    aiResponseRejected\n                ] = await Promise.all([\n                    getString('modal_title', 'local_forum_ai'),\n                    getString('discussion_label', 'local_forum_ai', data.discussion),\n                    getString('no_posts', 'local_forum_ai'),\n                    getString('ai_response', 'local_forum_ai'),\n                    getString('ai_response_approved', 'local_forum_ai'),\n                    getString('ai_response_rejected', 'local_forum_ai'),\n                ]);\n\n                ModalFactory.create({\n                    type: ModalFactory.types.DEFAULT,\n                    title: modalTitle,\n                    body: renderDiscussion(data, {\n                        discussionLabel,\n                        noPosts,\n                        aiResponse,\n                        aiResponseApproved,\n                        aiResponseRejected\n                    }),\n                    large: true,\n                }).done(modal => {\n                    modal.show();\n                });\n            }).fail(Notification.exception);\n        });\n    });\n};\n\n/**\n * Construye el HTML para el modal de historial.\n *\n * @param {Object} data Datos recibidos del servicio AJAX\n * @param {Object} strings Cadenas traducidas\n * @returns {Promise<string>} HTML\n */\nasync function renderDiscussion(data, strings) {\n    let html = `<h4>${data.course} / ${data.forum}</h4>\n                <h5>${strings.discussionLabel}</h5>`;\n\n    if (data.posts.length === 0) {\n        html += `<p class=\"text-warning\">${strings.noPosts}</p>`;\n    } else {\n        for (const post of data.posts) {\n            html += await renderPost(post);\n        }\n    }\n\n    let statusClass = 'bg-secondary';\n    let statusLabel = `<i class=\"fa fa-robot mr-2\"></i> ${strings.aiResponse}`;\n\n    if (data.status === 'approved') {\n        statusClass = 'bg-success text-white';\n        statusLabel = `<i class=\"fa fa-check mr-2\"></i> ${strings.aiResponseApproved}`;\n    } else if (data.status === 'rejected') {\n        statusClass = 'bg-danger text-white';\n        statusLabel = `<i class=\"fa fa-times mr-2\"></i> ${strings.aiResponseRejected}`;\n    }\n\n    html += `<div class=\"alert mt-4 ${statusClass}\">\n                <h5>${statusLabel}</h5>\n                ${data.airesponse}\n             </div>`;\n\n    return html;\n}\n"],"names":["renderDiscussion","data","strings","html","course","forum","discussionLabel","posts","length","noPosts","post","statusClass","statusLabel","aiResponse","status","aiResponseApproved","aiResponseRejected","airesponse","document","querySelectorAll","forEach","btn","addEventListener","e","token","currentTarget","dataset","call","methodname","args","done","async","modalTitle","Promise","all","discussion","create","type","ModalFactory","types","DEFAULT","title","body","large","modal","show","fail","Notification","exception"],"mappings":"qgBA4DeA,iBAAiBC,KAAMC,aAC9BC,mBAAcF,KAAKG,qBAAYH,KAAKI,4CACtBH,QAAQI,4BAEA,IAAtBL,KAAKM,MAAMC,OACXL,wCAAmCD,QAAQO,yBAEtC,MAAMC,QAAQT,KAAKM,MACpBJ,YAAc,0BAAWO,UAI7BC,YAAc,eACdC,uDAAkDV,QAAQW,kBAE1C,aAAhBZ,KAAKa,QACLH,YAAc,wBACdC,uDAAkDV,QAAQa,qBACnC,aAAhBd,KAAKa,SACZH,YAAc,uBACdC,uDAAkDV,QAAQc,qBAG9Db,uCAAkCQ,+CAChBC,8CACJX,KAAKgB,oCAGZd,mBA/ES,KAChBe,SAASC,iBAAiB,iBAAiBC,SAAQC,MAC/CA,IAAIC,iBAAiB,SAASC,UACpBC,MAAQD,EAAEE,cAAcC,QAAQF,oBAEjCG,KAAK,CAAC,CACPC,WAAY,6BACZC,KAAM,CAAEL,MAAOA,UACf,GAAGM,MAAKC,MAAAA,aAEJC,WACA1B,gBACAG,QACAI,WACAE,mBACAC,0BACMiB,QAAQC,IAAI,EAClB,mBAAU,cAAe,mBACzB,mBAAU,mBAAoB,iBAAkBjC,KAAKkC,aACrD,mBAAU,WAAY,mBACtB,mBAAU,cAAe,mBACzB,mBAAU,uBAAwB,mBAClC,mBAAU,uBAAwB,2CAGzBC,OAAO,CAChBC,KAAMC,uBAAaC,MAAMC,QACzBC,MAAOT,WACPU,KAAM1C,iBAAiBC,KAAM,CACzBK,gBAAAA,gBACAG,QAAAA,QACAI,WAAAA,WACAE,mBAAAA,mBACAC,mBAAAA,qBAEJ2B,OAAO,IACRb,MAAKc,QACJA,MAAMC,aAEXC,KAAKC,sBAAaC"}