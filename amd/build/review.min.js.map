{"version":3,"file":"review.min.js","sources":["../src/review.js"],"sourcesContent":["import Ajax from 'core/ajax';\nimport Notification from 'core/notification';\n\n/**\n * JS controller for the AI response review page.\n */\nexport const init = () => {\n    const editBtn = document.getElementById(\"edit-btn\");\n    const viewDiv = document.getElementById(\"airesponse-view\");\n    const editForm = document.getElementById(\"airesponse-edit\");\n    const cancelBtn = document.getElementById(\"cancel-edit\");\n    const textarea = editForm ? editForm.querySelector(\"textarea[name='message']\") : null;\n    const saveBtn = editForm ? editForm.querySelector(\"button[type='submit']\") : null;\n\n    const token = editForm ? editForm.dataset.token : null;\n\n    // --- Toggle editing ---\n    if (editBtn) {\n        editBtn.addEventListener(\"click\", () => {\n            viewDiv.style.display = \"none\";\n            editForm.style.display = \"block\";\n        });\n    }\n\n    if (cancelBtn) {\n        cancelBtn.addEventListener(\"click\", () => {\n            editForm.style.display = \"none\";\n            viewDiv.style.display = \"block\";\n        });\n    }\n\n    // --- Save changes via AJAX ---\n    if (saveBtn) {\n        saveBtn.addEventListener(\"click\", e => {\n            e.preventDefault();\n            const newMessage = textarea.value;\n\n            Ajax.call([{\n                methodname: \"local_forum_ai_update_response\",\n                args: { token: token, message: newMessage },\n            }])[0].done(response => {\n                if (response.status === \"ok\") {\n                    // Replace content in normal view\n                    viewDiv.querySelector(\".card-text\").innerHTML = response.message;\n\n                    Notification.addNotification({\n                        message: \"Response successfully updated.\",\n                        type: \"success\"\n                    });\n\n                    // Return to normal view\n                    editForm.style.display = \"none\";\n                    viewDiv.style.display = \"block\";\n                } else {\n                    Notification.addNotification({\n                        message: \"The response could not be updated.\",\n                        type: \"error\"\n                    });\n                }\n            }).fail(Notification.exception);\n        });\n    }\n\n    // --- Approve / Reject ---\n    document.querySelectorAll(\".action-btn\").forEach(btn => {\n        btn.addEventListener(\"click\", e => {\n            e.preventDefault();\n\n            const action = btn.dataset.action;\n            const token = btn.dataset.token;\n\n            Ajax.call([{\n                methodname: \"local_forum_ai_approve_response\",\n                args: { token: token, action: action },\n            }])[0].done(response => {\n                if (response.success) {\n                    Notification.addNotification({\n                        message: action === \"approve\"\n                            ? \"AI response approved and successfully published.\"\n                            : \"AI response rejected.\",\n                        type: \"success\"\n                    });\n\n                    setTimeout(() => {\n                        window.location.href = M.cfg.wwwroot + \"/mod/forum/discuss.php?d=\" + btn.dataset.discussionid;\n                    }, 1500);\n                } else {\n                    Notification.addNotification({\n                        message: \"The action could not be processed.\",\n                        type: \"error\"\n                    });\n                }\n            }).fail(Notification.exception);\n        });\n    });\n};\n"],"names":["editBtn","document","getElementById","viewDiv","editForm","cancelBtn","textarea","querySelector","saveBtn","token","dataset","addEventListener","style","display","e","preventDefault","newMessage","value","call","methodname","args","message","done","response","status","innerHTML","addNotification","type","fail","Notification","exception","querySelectorAll","forEach","btn","action","success","setTimeout","window","location","href","M","cfg","wwwroot","discussionid"],"mappings":"wXAMoB,WACVA,QAAUC,SAASC,eAAe,YAClCC,QAAUF,SAASC,eAAe,mBAClCE,SAAWH,SAASC,eAAe,mBACnCG,UAAYJ,SAASC,eAAe,eACpCI,SAAWF,SAAWA,SAASG,cAAc,4BAA8B,KAC3EC,QAAUJ,SAAWA,SAASG,cAAc,yBAA2B,KAEvEE,MAAQL,SAAWA,SAASM,QAAQD,MAAQ,KAG9CT,SACAA,QAAQW,iBAAiB,SAAS,KAC9BR,QAAQS,MAAMC,QAAU,OACxBT,SAASQ,MAAMC,QAAU,WAI7BR,WACAA,UAAUM,iBAAiB,SAAS,KAChCP,SAASQ,MAAMC,QAAU,OACzBV,QAAQS,MAAMC,QAAU,WAK5BL,SACAA,QAAQG,iBAAiB,SAASG,IAC9BA,EAAEC,uBACIC,WAAaV,SAASW,oBAEvBC,KAAK,CAAC,CACPC,WAAY,iCACZC,KAAM,CAAEX,MAAOA,MAAOY,QAASL,eAC/B,GAAGM,MAAKC,WACgB,OAApBA,SAASC,QAETrB,QAAQI,cAAc,cAAckB,UAAYF,SAASF,8BAE5CK,gBAAgB,CACzBL,QAAS,iCACTM,KAAM,YAIVvB,SAASQ,MAAMC,QAAU,OACzBV,QAAQS,MAAMC,QAAU,+BAEXa,gBAAgB,CACzBL,QAAS,qCACTM,KAAM,aAGfC,KAAKC,sBAAaC,cAK7B7B,SAAS8B,iBAAiB,eAAeC,SAAQC,MAC7CA,IAAItB,iBAAiB,SAASG,IAC1BA,EAAEC,uBAEImB,OAASD,IAAIvB,QAAQwB,OACrBzB,MAAQwB,IAAIvB,QAAQD,oBAErBS,KAAK,CAAC,CACPC,WAAY,kCACZC,KAAM,CAAEX,MAAOA,MAAOyB,OAAQA,WAC9B,GAAGZ,MAAKC,WACJA,SAASY,+BACIT,gBAAgB,CACzBL,QAAoB,YAAXa,OACH,mDACA,wBACNP,KAAM,YAGVS,YAAW,KACPC,OAAOC,SAASC,KAAOC,EAAEC,IAAIC,QAAU,4BAA8BT,IAAIvB,QAAQiC,eAClF,6BAEUjB,gBAAgB,CACzBL,QAAS,qCACTM,KAAM,aAGfC,KAAKC,sBAAaC"}