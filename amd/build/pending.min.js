define("local_forum_ai/pending",["exports","core/modal_factory","core/ajax","core/notification","./utils/renderPost","core/str"],(function(_exports,_modal_factory,_ajax,_notification,_renderPost,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);async function renderDiscussion(data){let editMode=arguments.length>1&&void 0!==arguments[1]&&arguments[1],strings=arguments.length>2?arguments[2]:void 0,html="<h4>".concat(data.course," / ").concat(data.forum,"</h4>\n                <h5>").concat(strings.discussionLabel,"</h5>");if(0===data.posts.length)html+='<p class="text-warning">'.concat(strings.noPosts,"</p>");else for(const post of data.posts)html+=await(0,_renderPost.renderPost)(post);return html+='<div class="alert alert-primary mt-4">\n               <h5><i class="fa-solid fa-robot"></i> '.concat(strings.aiResponseProposed,'</h5>\n               <div id="airesponse-content" data-token="').concat(data.token,'">'),html+=editMode?'\n            <textarea id="airesponse-edit" class="form-control" rows="5">'.concat(data.airesponse,'</textarea>\n            <div class="mt-2">\n                <button class="btn btn-success btn-sm save-ai" data-token="').concat(data.token,'">\n                    <i class="fa-solid fa-floppy-disk"></i> ').concat(strings.saveLabel,'\n                </button>\n                <button class="btn btn-primary btn-sm save-approve-ai" data-token="').concat(data.token,'">\n                    <i class="fa-solid fa-check"></i> ').concat(strings.saveApproveLabel,'\n                </button>\n                <button class="btn btn-danger btn-sm reject-ai" data-token="').concat(data.token,'">\n                    <i class="fa-solid fa-times"></i> ').concat(strings.rejectLabel,"\n                </button>\n            </div>\n        "):data.airesponse,html+="</div></div>",html}_exports.init=()=>{document.querySelectorAll(".view-details").forEach((btn=>{btn.addEventListener("click",(e=>{const token=e.currentTarget.dataset.token;_ajax.default.call([{methodname:"local_forum_ai_get_details",args:{token:token}}])[0].done((async data=>{const[modalTitle,discussionLabel,noPosts,aiResponseProposed,saveLabel,saveApproveLabel,rejectLabel]=await Promise.all([(0,_str.get_string)("modal_title_pending","local_forum_ai"),(0,_str.get_string)("discussion_label","local_forum_ai",data.discussion),(0,_str.get_string)("no_posts","local_forum_ai"),(0,_str.get_string)("ai_response_proposed","local_forum_ai"),(0,_str.get_string)("save","local_forum_ai"),(0,_str.get_string)("saveapprove","local_forum_ai"),(0,_str.get_string)("reject","local_forum_ai")]);_modal_factory.default.create({type:_modal_factory.default.types.DEFAULT,title:modalTitle,body:renderDiscussion(data,!0,{discussionLabel:discussionLabel,noPosts:noPosts,aiResponseProposed:aiResponseProposed,saveLabel:saveLabel,saveApproveLabel:saveApproveLabel,rejectLabel:rejectLabel}),large:!0}).done((modal=>{modal.show(),function(root,token){root.on("click",".save-ai",(e=>{e.preventDefault();const newMessage=root.find("#airesponse-edit").val();_ajax.default.call([{methodname:"local_forum_ai_update_response",args:{token:token,message:newMessage}}])[0].done((response=>{root.find("#airesponse-content").html(response.message),location.reload()})).fail(_notification.default.exception)})),root.on("click",".save-approve-ai",(e=>{e.preventDefault();const newMessage=root.find("#airesponse-edit").val();_ajax.default.call([{methodname:"local_forum_ai_update_response",args:{token:token,message:newMessage}}])[0].done((()=>{_ajax.default.call([{methodname:"local_forum_ai_approve_response",args:{token:token,action:"approve"}}])[0].done((()=>{location.reload()})).fail(_notification.default.exception)})).fail(_notification.default.exception)})),root.on("click",".reject-ai",(e=>{e.preventDefault(),_ajax.default.call([{methodname:"local_forum_ai_approve_response",args:{token:token,action:"reject"}}])[0].done((()=>{location.reload()})).fail(_notification.default.exception)}))}(modal.getRoot(),data.token)}))})).fail(_notification.default.exception)}))})),document.querySelectorAll(".action-btn").forEach((btn=>{btn.addEventListener("click",(e=>{e.preventDefault();const token=btn.dataset.token,action=btn.dataset.action;_ajax.default.call([{methodname:"local_forum_ai_approve_response",args:{token:token,action:action}}])[0].done((()=>{const row=btn.closest("tr");row&&row.remove()})).fail(_notification.default.exception)}))}))}}));

//# sourceMappingURL=pending.min.js.map