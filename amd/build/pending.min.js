define("local_forum_ai/pending",["exports","core/modal_factory","core/ajax","core/notification","./utils/renderPost"],(function(_exports,_modal_factory,_ajax,_notification,_renderPost){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);function renderDiscussion(data){let html="<h4>".concat(data.course," / ").concat(data.forum,"</h4>\n                <h5>Debate: ").concat(data.discussion,"</h5>");return 0===data.posts.length?html+='<p class="text-warning">No se encontraron posts en este debate.</p>':data.posts.forEach((post=>{html+=(0,_renderPost.renderPost)(post)})),html+='<div class="alert alert-primary mt-4">\n               <h5><i class="fa-solid fa-robot"></i> Respuesta AI propuesta \n                   <button class="btn btn-sm btn-link edit-ai" data-token="'.concat(data.token,'">\n                     <i class="fa fa-pencil"></i>\n                   </button>\n               </h5>\n               <div id="airesponse-content" data-token="').concat(data.token,'">').concat(data.airesponse,"</div>\n             </div>"),html}_exports.init=()=>{document.querySelectorAll(".view-details").forEach((btn=>{btn.addEventListener("click",(e=>{const token=e.currentTarget.dataset.token;_ajax.default.call([{methodname:"local_forum_ai_get_details",args:{token:token}}])[0].done((data=>{_modal_factory.default.create({type:_modal_factory.default.types.DEFAULT,title:"Detalles del debate",body:renderDiscussion(data),large:!0}).done((modal=>{modal.show()}))})).fail(_notification.default.exception)}))})),document.querySelectorAll(".action-btn").forEach((btn=>{btn.addEventListener("click",(e=>{e.preventDefault();const token=btn.dataset.token,action=btn.dataset.action;_ajax.default.call([{methodname:"local_forum_ai_approve_response",args:{token:token,action:action}}])[0].done((()=>{const row=btn.closest("tr");row&&row.remove()})).fail(_notification.default.exception)}))}))},document.addEventListener("click",(e=>{if(e.target.closest(".edit-ai")){const token=e.target.closest(".edit-ai").dataset.token,container=document.getElementById("airesponse-content"),currentText=container.innerHTML;container.innerHTML='\n            <textarea id="airesponse-edit" class="form-control" rows="5">'.concat(currentText,'</textarea>\n            <button class="btn btn-success btn-sm mt-2 save-ai" data-token="').concat(token,'">\n              <i class="fa-solid fa-floppy-disk"></i>\n            </button>\n        ')}if(e.target.closest(".save-ai")){const token=e.target.closest(".save-ai").dataset.token,newMessage=document.getElementById("airesponse-edit").value;_ajax.default.call([{methodname:"local_forum_ai_update_response",args:{token:token,message:newMessage}}])[0].done((response=>{document.getElementById("airesponse-content").innerHTML=response.message,location.reload()})).fail(_notification.default.exception)}}))}));

//# sourceMappingURL=pending.min.js.map