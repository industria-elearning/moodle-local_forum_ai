{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template local_forum_ai/review
    Plantilla para revisar respuestas AI.

    Example context (json):
    {
      "strdiscussioninfo": "Información de la discusión",
      "strcourse": "Curso",
      "course": "Matemáticas 101",
      "strforum": "Foro",
      "forum": "Debate inicial",
      "strdiscussion": "Discusión",
      "discussion": "Tema de ejemplo",
      "strcreated": "Creado",
      "timecreated": "2025-09-25",
      "stroriginalmessage": "Mensaje original",
      "originalsubject": "Asunto original",
      "originalmessage": "<p>Este es un mensaje de prueba</p>",
      "author": "Profesor X",
      "originaldate": "2025-09-20",
      "straiproposed": "Respuesta propuesta por AI",
      "aisubject": "Asunto AI",
      "aimessage": "<p>Mensaje generado por AI</p>",
      "aiformatted": "Texto editable AI",
      "strsave": "Guardar",
      "strcancel": "Cancelar",
      "strapprove": "Aprobar",
      "strreject": "Rechazar",
      "strbacktodiscussion": "Volver a la discusión",
      "discussionid": "123",
      "forumurl": "http://example.com/forum/123",
      "token": "abc123"
    }
}}

{{#headerlogo}}
<div class="local_forum_ai-logo-wrapper">
    <img src="{{logourl}}" alt="Logo Datacurso" class="local_forum_ai-pluginlogo">
</div>
{{/headerlogo}}

<div class="alert alert-info">
  <h5><i class="icon fa fa-info-circle"></i> {{strdiscussioninfo}}</h5>
  <p><strong>{{strcourse}}:</strong> {{course}}</p>
  <p><strong>{{strforum}}:</strong> {{forum}}</p>
  <p><strong>{{strdiscussion}}:</strong> {{discussion}}</p>
  <p><strong>{{strcreated}}:</strong> {{timecreated}}</p>
</div>

<div class="row">
  <div class="col-md-6">
    <div class="card mb-3">
      <div class="card-header"><h5><i class="fa fa-comment"></i> {{stroriginalmessage}}</h5></div>
      <div class="card-body">
        <h6>{{originalsubject}}</h6>
        {{{originalmessage}}}
        <br>
        <small class="text-muted">Por: {{author}} el {{originaldate}}</small>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card mb-3">
      <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0"><i class="fa fa-robot"></i> {{straiproposed}}</h5>
        <button id="edit-btn" class="btn btn-sm btn-light"><i class="fa fa-pencil"></i></button>
      </div>
      <div class="card-body">

        <!-- Vista normal -->
        <div id="airesponse-view" data-discussionid="{{discussionid}}">
          <h6>{{aisubject}}</h6>
          <div class="card-text">{{{aimessage}}}</div>
          <small class="text-muted">Respuesta AI generada</small>
        </div>

        <!-- Vista edición -->
        <form id="airesponse-edit" method="post" data-token="{{token}}" style="display:none;">
          <textarea name="message" class="form-control" rows="6">{{aiformatted}}</textarea>
          <button type="submit" class="btn btn-success btn-sm mt-2">
            <i class="fa fa-save"></i> {{strsave}}
          </button>
          <button type="button" id="cancel-edit" class="btn btn-secondary btn-sm mt-2">{{strcancel}}</button>
        </form>

      </div>
    </div>
  </div>
</div>

<!-- Botones aprobar/rechazar -->
<div class="row mt-4">
  <div class="col text-center">
    <button class="btn btn-success btn-lg action-btn" data-action="approve" data-token="{{token}}" data-discussionid="{{discussionid}}">
      <i class="fa fa-check"></i> {{strapprove}}
    </button>
    <button class="btn btn-danger btn-lg ml-2 action-btn" data-action="reject" data-token="{{token}}" data-discussionid="{{discussionid}}">
      <i class="fa fa-times"></i> {{strreject}}
    </button>
  </div>
</div>

<!-- Botón volver -->
<div class="row mt-3">
  <div class="col text-center">
    <a href="{{forumurl}}" class="btn btn-secondary">
      <i class="fa fa-arrow-left"></i> {{strbacktodiscussion}}
    </a>
  </div>
</div>

