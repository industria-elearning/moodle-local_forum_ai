{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template local_forum_ai/review
    Template for reviewing AI responses.

    Example context (json):
    {
      "strdiscussioninfo": "Discussion information",
      "strcourse": "Course",
      "course": "Mathematics 101",
      "strforum": "Forum",
      "forum": "Initial debate",
      "strdiscussion": "Discussion",
      "discussion": "Example topic",
      "strcreated": "Created",
      "timecreated": "2025-09-25",
      "stroriginalmessage": "Original message",
      "originalsubject": "Original subject",
      "originalmessage": "<p>This is a test message</p>",
      "author": "Professor X",
      "originaldate": "2025-09-20",
      "straiproposed": "AI proposed response",
      "aisubject": "AI subject",
      "aimessage": "<p>AI generated message</p>",
      "aiformatted": "AI editable text",
      "strsave": "Save",
      "strcancel": "Cancel",
      "strapprove": "Approve",
      "strreject": "Reject",
      "strbacktodiscussion": "Back to discussion",
      "discussionid": "123",
      "forumurl": "http://example.com/forum/123",
      "token": "abc123"
    }
}}

{{#headerlogo}}
<a class="local_forum_ai-logo-wrapper" href="https://datacurso.com/" target="_blank" rel="noopener noreferrer">
    <img src="{{logourl}}" alt="Datacurso Logo" class="local_forum_ai-pluginlogo">
</a>
{{/headerlogo}}

<div class="alert alert-info">
  <h5><i class="icon fa fa-info-circle"></i> {{strdiscussioninfo}}</h5>
  <p><strong>{{strcourse}}:</strong> {{course}}</p>
  <p><strong>{{strforum}}:</strong> {{forum}}</p>
  <p><strong>{{strdiscussion}}:</strong> {{discussion}}</p>
  <p><strong>{{strcreated}}:</strong> {{timecreated}}</p>
</div>

<div class="row">
  <div class="col-md-6">
    <div class="card mb-3">
      <div class="card-header"><h5><i class="fa fa-comment"></i> {{stroriginalmessage}}</h5></div>
      <div class="card-body">
        <h6>{{originalsubject}}</h6>
        {{{originalmessage}}}
        <br>
        <small class="text-muted">By: {{author}} on {{originaldate}}</small>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card mb-3">
      <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0"><i class="fa fa-robot"></i> {{straiproposed}}</h5>
        <button id="edit-btn" class="btn btn-sm btn-light"><i class="fa fa-pencil"></i></button>
      </div>
      <div class="card-body">

        <!-- Normal view -->
        <div id="airesponse-view" data-discussionid="{{discussionid}}">
          <h6>{{aisubject}}</h6>
          <div class="card-text">{{{aimessage}}}</div>
          <small class="text-muted">AI generated response</small>
        </div>

        <!-- Edit view -->
        <form id="airesponse-edit" method="post" data-token="{{token}}" style="display:none;">
          <textarea name="message" class="form-control" rows="6">{{aiformatted}}</textarea>
          <button type="submit" class="btn btn-success btn-sm mt-2">
            <i class="fa fa-save"></i> {{strsave}}
          </button>
          <button type="button" id="cancel-edit" class="btn btn-secondary btn-sm mt-2">{{strcancel}}</button>
        </form>

      </div>
    </div>
  </div>
</div>

<!-- Approve / Reject buttons -->
<div class="row mt-4">
  <div class="col text-center">
    <button class="btn btn-success btn-lg action-btn" data-action="approve" data-token="{{token}}" data-discussionid="{{discussionid}}">
      <i class="fa fa-check"></i> {{strapprove}}
    </button>
    <button class="btn btn-danger btn-lg ml-2 action-btn" data-action="reject" data-token="{{token}}" data-discussionid="{{discussionid}}">
      <i class="fa fa-times"></i> {{strreject}}
    </button>
  </div>
</div>

<!-- Back button -->
<div class="row mt-3">
  <div class="col text-center">
    <a href="{{forumurl}}" class="btn btn-secondary">
      <i class="fa fa-arrow-left"></i> {{strbacktodiscussion}}
    </a>
  </div>
</div>
